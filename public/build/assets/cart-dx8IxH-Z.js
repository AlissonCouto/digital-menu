jQuery(function(e){if(K(),e(".phoneMask").each(function(){var t=e(this);t.val()&&t.trigger("blur")}),e("#clientOrderCreate").on("submit",function(t){t.preventDefault();let i=[],s,r=e("#name").val(),a=e("#whatsapp").val(),o=e("#password").val(),c=e("#street").val(),l=e("#number").val(),u=e("#neighborhood").val(),n=e("#reference").val();const m={name:r,whatsapp:a,password:o,street:c,number:l,neighborhood:u,reference:n};s={name:"required|string|min:3|max:255",whatsapp:"required|string|min:15|max:16"},e(".form-checkout #street").length>0?(s.password="required|strong_password",e('input[name="address"]').val()=="delivery"&&(s.street="required|string|min:5",s.number="required|integer",s.neighborhood="required|string|min:5",s.reference="nullable|string|min:5")):s.whatsapp="required|string|min:15|max:16";let d=Z(m,s);if(e(".form-floating input").removeClass("is-invalid"),e(".field-error").html(""),Object.keys(d).length>0&&e.each(d,function(p,y){e(".form-floating #"+p).addClass("is-invalid"),e("#"+p).closest(".form-floating").next(".field-error").html(y)}),i.length>0){var b='<ul class="list-errors">';i.forEach(p=>{b+=`<li>${p}<li>`}),b+="</ul>",_(b)}else{let p=v();e("<input>").attr({type:"hidden",name:"cart",value:JSON.stringify(p)}).appendTo("#clientOrderCreate"),console.log("CARRINHO ",p),this.submit()}}),X("delivery"),e('meta[name="uri"]').attr("content")=="finalizar-compra"){let t=e('input[name="address"]').val();X(t)}e('input[name="address"]').on("change",function(t){let i=e(this).val();X(i)});function X(t){let i=v(),s=R();t=="delivery"?i.shipping=s:i.shipping=0,x(i),I()}I(),e("body").on("input","#observations",function(){let t=e(this).val().length;t<=200?(e(this).css("border","1px solid #808080"),e(".observations .caracteres").html(t+"/200")):(e(this).css("border","1px solid #fb1432"),e(this).val(e(this).val().substring(0,200)))}),e("body").on("click",".add-comments",function(t){let i=e(this).closest(".item").data("item-id");H(i)}),e("body").on("click","#modal-comments .btn-modal",function(t){let i=e(this).closest("#modal-comments").attr("data-id");W(i)}),e("body").on("click","#modal-comments .btn-close",function(){T()}),e(".overlayer").on("click",function(t){t.target==this&&T()}),e(".open-cart, .close-cart").on("click",function(){J()}),e(".clear-cart").on("click",function(){Y(),I()}),e("#addToCart").on("click",function(t){L()}),e("body").on("click",".quantity-add, .quantity-remove",function(){let t=e(this).data("op"),i=e(this).closest(".item").data("item-id");V(i,t,1)}),e("body").on("click",".single-product .quantity-footer .add, .single-product .quantity-footer .rem",function(){let t=e(this).data("op"),i=parseInt(e(".single-product .quantity-footer .total").text());t=="add"?i>=1&&(i+=1):i>1&&(i-=1),e(".single-product .quantity-footer .total").html(i);var s=e("#categoryName").val();if(s=="pizzas"){let c=e('input[name="pizza-checkbox"]:checked');var r=0;c.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))})}else var r=e(".single-product .meta-infos .price").data("price");let a=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),o=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e('input[name="pizza-checkbox"]').on("change",function(){let t=parseInt(e(".single-product .quantity-footer .total").text()),i=e('input[name="pizza-checkbox"]:checked');var s=0;i.each(function(){s<e(this).data("price")&&(s=e(this).data("price"))});let r=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),a=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(s)+r+a)*t))}),e('.borders-pastas input[name="border"]').on("change",function(t){let i=parseInt(e(".single-product .quantity-footer .total").text()),s=e('input[name="pizza-checkbox"]:checked');var r=0;s.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))});let a=parseFloat(e(this).data("price"))||0,o=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e('.borders-pastas input[name="pasta"]').on("change",function(t){let i=parseInt(e(".single-product .quantity-footer .total").text()),s=e('input[name="pizza-checkbox"]:checked');var r=0;s.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))});let a=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),o=parseFloat(e(this).data("price"))||0;e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e("body").on("click",".remove-item-cart",function(){let t=e(this).closest(".item").data("item-id");E(t)}),e("#coupon").on("input",function(t){if(e(this).val().length>3){let i=e(this).val(),s=v(),r=s.subtotal+parseFloat(s.shipping);A(i,r)}});function _(t){let i=`
            <div id="error-cart-form" class="error-cart-form">
                <div class="header">
                    <div class="icon rounded-circle">
                        <span><i class="mdi mdi-close"></i></span>
                    </div>
    
                    <button type="button" id="close-errors">
                        <i class="mdi mdi-close"></i>
                    </button>
                </div>
                
                ${t}
            </div>
        `;e("body").append(i),setTimeout(function(){e("#error-order-form").remove()},2e4)}function A(t,i){let r=e('meta[name="root"]').attr("content")+"/apply-coupon";e.ajax({url:r,type:"get",dataType:"json",data:{name:t,total:i},success:function(a){let o=e("#coupon").closest(".coupon").find(".message");if(o.removeClass("success"),o.removeClass("error"),e("#coupon").removeClass("bordersuccess"),e("#coupon").removeClass("bordererror"),a.success){e("#coupon").addClass("bordersuccess");let c=v(),l={name:t,discount_type:a.discount_type,discount:parseFloat(a.discount),value:parseFloat(a.value)};c.discounts=l.discount,c.coupon=l,x(c),I()}else e("#coupon").addClass("bordererror");o.addClass(a.success==!0?"success":"error"),o.html(a.message)},error:function(a){console.log("ERRO: ",a)}})}function L(){var t=v(),i=e("#img").val(),s={},r=e("#observations").val();let a=e("#categoryName").val();var o={id:e("#categoryId").val(),name:a},c=parseInt(e(".single-product .quantity-footer .total").text());if(a=="pizzas"){var l=e('input[name="pizza-checkbox"]:checked');let d=e("#size").val(),b=e("#sizeId").val();var u=e('input[name="border"]:checked');let p={id:u.val(),name:u.data("name"),price:u.data("price")};var n=e('input[name="pasta"]:checked');let y={id:n.val(),name:n.data("name"),price:n.data("price")};switch(d){case"Grande":d="G";break;case"Média":d="M";break;default:d="B"}let k=0;if(l.length==1?k=e(l[0]).val()+"+"+d:k=e(l[0]).val()+"+"+e(l[1]).val()+"+"+d,t.items.find(g=>g.id===k))t.items.map(g=>{g.id==k&&(g.quantity+=c)}),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"});else if(l.length==0)q({message:"Selecione ao menos um sabor",icon:'<i class="mdi mdi-close"></i>',type:"-error"});else if(l.length>2)q({message:"Escolha no máximo dois sabores",icon:'<i class="mdi mdi-close"></i>',type:"-error"});else{var m=[];if(l.length==1){l.each(function(){m=j(this)});let g=m.productId+"+"+d,O="Pizza ("+d+") "+m.name,C=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),P=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);s={id:g,name:O,size:d,sizeId:b,border:p,pasta:y,price:parseFloat(m.price)+C+P,img:i,quantity:c,category:o,observations:r,products:m},t.items.push(s),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}else{l.each(function(){let N=j(this);m.push(N)});let g=m[0].productId+"+"+m[1].productId+"+"+d,O=m[0].price>m[1].price?m[0].price:m[1].price,C="Pizza ("+d+") ";C+="1/2 "+m[0].name+" 1/2 "+m[1].name;let P=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),F=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);s={id:g,name:C,size:d,sizeId:b,price:parseFloat(O)+P+F,border:p,pasta:y,img:i,quantity:c,category:o,observations:r,products:m},t.items.push(s),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}}e('input[name^="additional"]').prop("checked",!1),e('.borders-pastas input[name="pasta"]:first').prop("checked",!0),e('.borders-pastas input[name="border"]').prop("checked",!1),e('input[name="pizza-checkbox"]').prop("checked",!1),e(".single-product #observations").val(""),e(".single-product .observations .caracteres").html("0/200"),e(".single-product .quantity-footer .total").text("1")}else{let d=e("#productId").val();if(t.items.find(p=>p.id===d))t.items.map(p=>{p.id==d&&(p.quantity+=c)}),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"});else{let p=e(".single-product #productId").val(),y=e(".single-product .meta-infos .price").data("price"),k=e(".single-product .meta-infos .title").data("name");s={id:p,name:k,price:y,img:i,quantity:c,category:o,observations:r},t.items.push(s)}q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}x(t),I()}function q(t){e("body").append(`
            <div id="card-notification" class="card-notification">
                <div
                class="icon rounded-circle ${t.type}">
                <span>${t.icon}</span>
                </div>
                ${t.message}
            </div>
        `),e("#card-notification").effect("bounce",{times:3},300),setTimeout(function(){e("#card-notification").remove()},3e3)}function j(t){let i=e(t).val(),s=e(t).data("name"),r=e(t).data("price"),a=e('input[name="additional['+e(t).val()+']"]:checked'),o=[];a.length>0&&a.each(function(u,n){o.push({id:e(n).val(),name:e(n).data("name")})});let c=e('input[name="ingredient['+e(t).val()+']"]:not(:checked)'),l=[];return c.length>0&&c.each(function(u,n){l.push({id:e(n).val(),name:e(n).data("name")})}),{productId:i,name:s,price:r,additionals:o,removedIngredients:l}}function E(t){let i=v(),s=i.items.filter(r=>r.id!=t);i.items=s||[],x(i),I()}function V(t,i,s){let r=v();s=parseInt(s),r.items.map(a=>{a.id==t&&(i=="add"?s>=1&&(a.quantity+=s):s>=1&&(a.quantity>1?a.quantity-=s:r.items.splice(t,1)))}),x(r),I()}function Y(){localStorage.removeItem("cart")}function R(){return e('meta[name="deliveryValue"]').attr("content")}function v(){let t=R(),i={items:[],coupon:{},formPayment:null,deliveryMethod:null,discounts:0,shipping:parseFloat(t)||0,subtotal:0,total:0};return JSON.parse(localStorage.getItem("cart"))||i}function x(t){localStorage.setItem("cart",JSON.stringify(t))}function J(){e("#cart").toggleClass("opened")}async function I(){let t=v();var i=t.discounts,s=t.shipping,r=0,a=0;if(e("#cart .cart-body .items").html(""),t.items.length==0)e("#cart .cart-body .items").html(`
                <div class="w-100 d-flex align-items-center justify-content-center">
                    <h1 class="text-center empty-cart">Carrinho vazio</h1>
                </div>
            `);else{var o={};t.items.forEach(function(n){o.id=n.id,o.quantity=n.quantity,o.img=n.img,typeof n.products>"u"||n.products.length>1,o.title=n.name,o.price=n.price*o.quantity,r=r+=o.price,w(o)})}let c=t.coupon;c.name;let l=r+parseFloat(t.shipping);i=B(c,l),a=r+parseFloat(s)-i,t.total=a,t.subtotal=r,t.shipping=s,t.discounts=i,x(t),e("#cart .cart-footer .total .value").html(f(a)),e("#cart .cart-footer .shipping .value").html(f(s)),e("#cart .cart-footer .subtotal .value").html(f(r)),e(".menu .item-cart .total").html(U()),e('meta[name="uri"]').attr("content")=="finalizar-compra"&&Q(a,r,s,i),e('meta[name="uri"]').attr("content")=="carrinho"&&G()}function B(t,i){return t.discount_type=="value"?t.discount:t.discount_type=="percent"?i*(t.value/100):0}function Q(t,i,s,r){e(".checkout .values .subtotal .value").html(f(i)),e(".checkout .values .shipping .value").html(f(s)),e(".checkout .values .discount .value").html(f(r)),e(".checkout .values .total .value").html(f(t))}function G(){var t=e(".page-cart .cart-items");t.html("");let i=v();i.items.length>0?(i.items.forEach(function(s){t.append(`
                    <div class="item" data-item-id="${s.id}">

                        <div class="meta-infos ">

                            <div class="title">${s.quantity}x - ${s.name}</div>
                            <div class="price">${f(s.price*s.quantity)}</div>
                            <a class="add-comments">Adicionar observação</a>

                        </div>

                        <div class="button">

                            <div class="quantity">
                                <button class="rem quantity-remove" data-op="rm">
                                    <i class="mdi mdi-minus"></i>
                                </button>
                                <span class="total quantity-value">${s.quantity}</span>
                                <button class="add quantity-add"  data-op="add">
                                    <i class="mdi mdi-plus"></i>
                                </button>
                            </div>

                        </div>

                    </div>
                `)}),e(".button .add-cart .value").html(f(i.total))):t.html('<div class="item"><h1>Carrinho vazio</h1></div>')}function U(){var t=0;return v().items.forEach(i=>{t+=parseInt(i.quantity)}),t}function w(t){e("#cart .cart-body .items").append(`
                <div class="item" data-item-id="${t.id}">
                    <div class="img">
                        <img src="${t.img}" alt="Imagem do produto" class="image-fluid">
                    </div>
            
                    <div class="meta-infos">
                        <div class="line-1">
                            <div class="title">${t.title}</div>
                            <button type="button" class="remove remove-item-cart"><i class="mdi mdi-delete"></i></button>
                        </div>
                
                        <div class="line-2">
                            <div class="quantity-control">
                                <button type="button" class="quantity-remove" data-op="rm">
                                    <i class="mdi mdi-minus"></i>
                                </button>
                
                                <span class="quantity-value">${t.quantity}</span>
                                        
                                <button type="button" class="quantity-add" data-op="add">
                                    <i class="mdi mdi-plus"></i>
                                </button>
                            </div>
                
                            <div class="prices">
                                <div class="price"><span class="number">${f(t.price)}</span></div>
                            </div>
                        </div>
                    </div> <!-- .meta-infos -->
                </div> <!-- .item -->
            `)}function f(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}function H(t){let i=e("#modal-comments");i.attr("data-id",t);let r=v().items.find(a=>a.id==t);i.find(".observations textarea").val(r.observations),i.toggle()}function T(){let t=e("#modal-comments");t.attr("data-id","0"),t.find(".observations textarea").val(""),t.toggle()}function W(t){let i=e("#modal-comments");var s=t;let r=v();r.items.map(a=>{if(a.id==s){let o=i.find(".observations textarea").val();a.observations=o}}),x(r),i.attr("data-id","0"),i.find(".observations textarea").val(""),i.toggle()}function Z(t,i){const s={};e(".field-error").html("");var r=e('meta[name="root"]').attr("content");for(const a in i){const o=i[a];for(const c of o.split("|")){const[l,u]=c.split(":");switch(l){case"required":t[a]||(s[a]=`O campo ${a} é obrigatório.`);break;case"strong_password":const n=/[A-Z]/,m=/[a-z]/,d=/[0-9]/,b=/[^\w]/,p=8,y=n.test(t[a]),k=m.test(t[a]),z=d.test(t[a]),g=b.test(t[a]),O=t[a].length>=p;y&&k&&z&&g&&O||(s[a]=`A senha no campo ${a} não atende aos critérios de segurança.`);break;case"same":t[a]!==t[u]&&(s[a]=`O campo ${a} deve ser igual ao campo ${u}.`);break;case"string":t[a]&&typeof t[a]!="string"&&(s[a]=`O campo ${a} deve ser uma string.`);break;case"min":t[a]&&t[a].length<u&&(s[a]=`O campo ${a} deve ter no mínimo ${u} caracteres.`);break;case"max":t[a]&&t[a].length>u&&(s[a]=`O campo ${a} deve ter no máximo ${u} caracteres.`);break;case"nullable":if(t[a]!==null&&typeof t[a]<"u")break;continue;case"date":t[a]&&!/^\d{4}-\d{2}-\d{2}$/.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de data válido (YYYY-MM-DD).`);break;case"date_format":const C=u.toUpperCase(),P=/^\d{4}-\d{2}-\d{2}$/;t[a]&&!P.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de data válido (${C}).`);break;case"before_or_equal":const F=new Date;F.setFullYear(F.getFullYear()-18);const N=new Date(t[a]);t[a]&&N>F&&(s[a]=`O campo ${a} deve ser uma data anterior ou igual a ${F.toISOString().split("T")[0]}.`);break;case"email":const $=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;t[a]&&!$.test(t[a])&&(s[a]=`O campo ${a} deve ser um email válido.`);break;case"cpf":const ee=/^\d{3}\.\d{3}\.\d{3}-\d{2}$/;t[a]&&!ee.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de CPF válido (XXX.XXX.XXX-XX).`);break;case"cnpj":const te=/^\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}$/;t[a]&&!te.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de CNPJ válido (XX.XXX.XXX/XXXX-XX).`);break;case"unique":a==="email"&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/email-unique",data:{email:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1}),a=="cpf"&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/cpf-unique",data:{cpf:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1}),(a=="whatsapp"||a=="phone")&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/phone-unique",data:{phone:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1});break;case"numeric":t[a]&&isNaN(t[a])&&(s[a]=`O campo ${a} deve ser um valor numérico.`);break;case"digits_between":const[D,M]=u.split(",");t[a]&&(t[a].length<D||t[a].length>M)&&(s[a]=`O campo ${a} deve ter entre ${D} e ${M} dígitos.`);break;case"digits":t[a]&&t[a].length!==parseInt(u)&&(s[a]=`O campo ${a} deve ter exatamente ${u} dígitos.`);break;case"exists":let S="";a==="inputCity"&&(S={id:t[a],entity:"city"}),a==="inputState"&&(S={uf:t[a],entity:"state"}),e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:"/rule-exists",data:S,success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} é inválido.`)},async:!1});break}}}return s}function K(){e(".phoneMask").on("input",function(t){this.value=this.value.replace(/\D/g,"")}),e(".phoneMask").on("blur",function(t){var i=e(this).val().replace(/\D/g,""),s="";i.length===11?s="("+i.substring(0,2)+") "+i.substring(2,3)+" "+i.substring(3,7)+"-"+i.substring(7,11):i.length===10&&(s="("+i.substring(0,2)+") 9 "+i.substring(2,6)+"-"+i.substring(6,10)),e(this).val(s)})}});
