jQuery(function(e){if(K(),e(".phoneMask").each(function(){var t=e(this);t.val()&&t.trigger("blur")}),e("#clientOrderCreate").on("submit",function(t){t.preventDefault();let i=[],s,r=e("#name").val(),a=e("#whatsapp").val(),o=e("#password").val(),n=e("#street").val(),c=e("#number").val(),p=e("#neighborhood").val(),d=e("#reference").val();const u={name:r,whatsapp:a,password:o,street:n,number:c,neighborhood:p,reference:d};s={name:"required|string|min:3|max:255",whatsapp:"required|string|min:15|max:16"},e(".form-checkout #street").length>0?(s.password="required|strong_password",e('input[name="address"]').val()=="delivery"&&(s.street="required|string|min:5",s.number="required|integer",s.neighborhood="required|string|min:5",s.reference="nullable|string|min:5")):s.whatsapp="required|string|min:15|max:16";let l=H(u,s);if(e(".form-floating input").removeClass("is-invalid"),e(".field-error").html(""),Object.keys(l).length>0&&e.each(l,function(m,y){e(".form-floating #"+m).addClass("is-invalid"),e("#"+m).closest(".form-floating").next(".field-error").html(y)}),i.length>0){var b='<ul class="list-errors">';i.forEach(m=>{b+=`<li>${m}<li>`}),b+="</ul>",A(b)}else{let m=v();e("<input>").attr({type:"hidden",name:"cart",value:JSON.stringify(m)}).appendTo("#clientOrderCreate"),this.submit()}}),X("delivery"),e('meta[name="uri"]').attr("content")=="finalizar-compra"){let t=e('input[name="address"]').val();X(t)}e('input[name="address"]').on("change",function(t){let i=e(this).val();X(i)});function X(t){let i=v(),s=T();t=="delivery"?i.shipping=s:i.shipping=0,x(i),I()}I(),e("body").on("input","#observations",function(){let t=e(this).val().length;t<=200?(e(this).css("border","1px solid #808080"),e(".observations .caracteres").html(t+"/200")):(e(this).css("border","1px solid #fb1432"),e(this).val(e(this).val().substring(0,200)))}),e("body").on("click",".add-comments",function(t){let i=e(this).closest(".item").data("item-id");W(i)}),e("body").on("click","#modal-comments .btn-modal",function(t){let i=e(this).closest("#modal-comments").attr("data-id");Z(i)}),e("body").on("click","#modal-comments .btn-close",function(){R()}),e(".overlayer").on("click",function(t){t.target==this&&R()}),e(".open-cart, .close-cart").on("click",function(){J()}),e(".clear-cart").on("click",function(){z(),I()}),e("#addToCart").on("click",function(t){E()}),e("body").on("click",".quantity-add, .quantity-remove",function(){let t=e(this).data("op"),i=e(this).closest(".item").data("item-id");Y(i,t,1)}),e("body").on("click",".single-product .quantity-footer .add, .single-product .quantity-footer .rem",function(){let t=e(this).data("op"),i=parseInt(e(".single-product .quantity-footer .total").text());t=="add"?i>=1&&(i+=1):i>1&&(i-=1),e(".single-product .quantity-footer .total").html(i);var s=e("#categoryName").val();if(s=="pizzas"){let n=e('input[name="pizza-checkbox"]:checked');var r=0;n.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))})}else var r=e(".single-product .meta-infos .price").data("price");let a=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),o=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e('input[name="pizza-checkbox"]').on("change",function(){let t=parseInt(e(".single-product .quantity-footer .total").text()),i=e('input[name="pizza-checkbox"]:checked');var s=0;i.each(function(){s<e(this).data("price")&&(s=e(this).data("price"))});let r=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),a=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(s)+r+a)*t))}),e('.borders-pastas input[name="border"]').on("change",function(t){let i=parseInt(e(".single-product .quantity-footer .total").text()),s=e('input[name="pizza-checkbox"]:checked');var r=0;s.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))});let a=parseFloat(e(this).data("price"))||0,o=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e('.borders-pastas input[name="pasta"]').on("change",function(t){let i=parseInt(e(".single-product .quantity-footer .total").text()),s=e('input[name="pizza-checkbox"]:checked');var r=0;s.each(function(){r<e(this).data("price")&&(r=e(this).data("price"))});let a=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),o=parseFloat(e(this).data("price"))||0;e(".single-product #addToCart .value").html(f((parseFloat(r)+a+o)*i))}),e("body").on("click",".remove-item-cart",function(){let t=e(this).closest(".item").data("item-id");V(t)}),e("#coupon").on("input",function(t){if(e(this).val().length>3){let i=e(this).val(),s=v(),r=s.subtotal+parseFloat(s.shipping);L(i,r)}});function A(t){let i=`
            <div id="error-cart-form" class="error-cart-form">
                <div class="header">
                    <div class="icon rounded-circle">
                        <span><i class="mdi mdi-close"></i></span>
                    </div>
    
                    <button type="button" id="close-errors">
                        <i class="mdi mdi-close"></i>
                    </button>
                </div>
                
                ${t}
            </div>
        `;e("body").append(i),setTimeout(function(){e("#error-order-form").remove()},2e4)}function L(t,i){let r=e('meta[name="root"]').attr("content")+"/apply-coupon";e.ajax({url:r,type:"get",dataType:"json",data:{name:t,total:i},success:function(a){let o=e("#coupon").closest(".coupon").find(".message");if(o.removeClass("success"),o.removeClass("error"),e("#coupon").removeClass("bordersuccess"),e("#coupon").removeClass("bordererror"),a.success){e("#coupon").addClass("bordersuccess");let n=v(),c={name:t,discount_type:a.discount_type,discount:parseFloat(a.discount),value:parseFloat(a.value)};n.discounts=c.discount,n.coupon=c,x(n),I()}else e("#coupon").addClass("bordererror");o.addClass(a.success==!0?"success":"error"),o.html(a.message)},error:function(a){console.log("ERRO: ",a)}})}function E(){var t=v(),i=e("#img").val(),s={},r=e("#observations").val();let a=e("#categoryName").val();var o={id:e("#categoryId").val(),name:a},n=parseInt(e(".single-product .quantity-footer .total").text());if(a=="pizzas"){var c=e('input[name="pizza-checkbox"]:checked');let l=e("#size").val(),b=e("#sizeId").val();var p=e('input[name="border"]:checked');let m={id:p.val(),name:p.data("name"),price:p.data("price")};var d=e('input[name="pasta"]:checked');let y={id:d.val(),name:d.data("name"),price:d.data("price")};switch(l){case"Grande":l="G";break;case"Média":l="M";break;default:l="B"}let k=0;if(c.length==1?k=e(c[0]).val()+"+"+l:k=e(c[0]).val()+"+"+e(c[1]).val()+"+"+l,t.items.find(g=>g.id===k))t.items.map(g=>{g.id==k&&(g.quantity+=n)}),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"});else if(c.length==0)q({message:"Selecione ao menos um sabor",icon:'<i class="mdi mdi-close"></i>',type:"-error"});else if(c.length>2)q({message:"Escolha no máximo dois sabores",icon:'<i class="mdi mdi-close"></i>',type:"-error"});else{var u=[];if(c.length==1){c.each(function(){u=j(this)});let g=u.productId+"+"+l,P="Pizza ("+l+") "+u.name,C=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),O=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);s={id:g,name:P,size:l,sizeId:b,border:m,pasta:y,price:parseFloat(u.price)+C+O,img:i,quantity:n,category:o,observations:r,products:u},t.items.push(s),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}else{c.each(function(){let N=j(this);u.push(N)});let g=u[0].productId+"+"+u[1].productId+"+"+l,P=u[0].price>u[1].price?u[0].price:u[1].price,C="Pizza ("+l+") ";C+="1/2 "+u[0].name+" 1/2 "+u[1].name;let O=parseFloat(e('.borders-pastas input[name="border"]:checked').data("price")||0),F=parseFloat(e('.borders-pastas input[name="pasta"]:checked').data("price")||0);s={id:g,name:C,size:l,sizeId:b,price:parseFloat(P)+O+F,border:m,pasta:y,img:i,quantity:n,category:o,observations:r,products:u},t.items.push(s),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}}e('input[name^="additional"]').prop("checked",!1),e('.borders-pastas input[name="pasta"]:first').prop("checked",!0),e('.borders-pastas input[name="border"]').prop("checked",!1),e('input[name="pizza-checkbox"]').prop("checked",!1),e(".single-product #observations").val(""),e(".single-product .observations .caracteres").html("0/200"),e(".single-product .quantity-footer .total").text("1")}else{let l=e("#productId").val();if(t.items.find(m=>m.id===l))t.items.map(m=>{m.id==l&&(m.quantity+=n)}),q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"});else{let m=e(".single-product #productId").val(),y=e(".single-product .meta-infos .price").data("price"),k=e(".single-product .meta-infos .title").data("name");s={id:m,name:k,price:y,img:i,quantity:n,category:o,observations:r},t.items.push(s)}q({message:"Adicionado ao carrinho",icon:'<i class="mdi mdi-check"></i>',type:"-success"})}x(t),I()}function q(t){e("body").append(`
            <div id="card-notification" class="card-notification">
                <div
                class="icon rounded-circle ${t.type}">
                <span>${t.icon}</span>
                </div>
                ${t.message}
            </div>
        `),e("#card-notification").effect("bounce",{times:3},300),setTimeout(function(){e("#card-notification").remove()},3e3)}function j(t){let i=e(t).val(),s=e(t).data("name"),r=e(t).data("price"),a=e('input[name="additional['+e(t).val()+']"]:checked'),o=[];a.length>0&&a.each(function(){o.push({id:e(t).val(),name:e(t).data("name")})});let n=e('input[name="ingredient['+e(t).val()+']"]:not(:checked)'),c=[];return n.length>0&&n.each(function(){c.push({id:e(t).val(),name:e(t).data("name")})}),{productId:i,name:s,price:r,additionals:o,removedIngredients:c}}function V(t){let i=v(),s=i.items.filter(r=>r.id!=t);i.items=s||[],x(i),I()}function Y(t,i,s){let r=v();s=parseInt(s),r.items.map(a=>{a.id==t&&(i=="add"?s>=1&&(a.quantity+=s):s>=1&&(a.quantity>1?a.quantity-=s:r.items.splice(t,1)))}),x(r),I()}function z(){localStorage.removeItem("cart")}function T(){return e('meta[name="deliveryValue"]').attr("content")}function v(){let t=T(),i={items:[],coupon:{},formPayment:null,deliveryMethod:null,discounts:0,shipping:parseFloat(t)||0,subtotal:0,total:0};return JSON.parse(localStorage.getItem("cart"))||i}function x(t){localStorage.setItem("cart",JSON.stringify(t))}function J(){e("#cart").toggleClass("opened")}async function I(){let t=v();var i=t.discounts,s=t.shipping,r=0,a=0;if(e("#cart .cart-body .items").html(""),t.items.length==0)e("#cart .cart-body .items").html(`
                <div class="w-100 d-flex align-items-center justify-content-center">
                    <h1 class="text-center empty-cart">Carrinho vazio</h1>
                </div>
            `);else{var o={};t.items.forEach(function(d){o.id=d.id,o.quantity=d.quantity,o.img=d.img,typeof d.products>"u"||d.products.length>1,o.title=d.name,o.price=d.price*o.quantity,r=r+=o.price,w(o)})}let n=t.coupon;n.name;let c=r+parseFloat(t.shipping);i=B(n,c),a=r+parseFloat(s)-i,t.total=a,t.subtotal=r,t.shipping=s,t.discounts=i,x(t),e("#cart .cart-footer .total .value").html(f(a)),e("#cart .cart-footer .shipping .value").html(f(s)),e("#cart .cart-footer .subtotal .value").html(f(r)),e(".menu .item-cart .total").html(U()),e('meta[name="uri"]').attr("content")=="finalizar-compra"&&Q(a,r,s,i),e('meta[name="uri"]').attr("content")=="carrinho"&&G()}function B(t,i){return t.discount_type=="value"?t.discount:t.discount_type=="percent"?i*(t.value/100):0}function Q(t,i,s,r){e(".checkout .values .subtotal .value").html(f(i)),e(".checkout .values .shipping .value").html(f(s)),e(".checkout .values .discount .value").html(f(r)),e(".checkout .values .total .value").html(f(t))}function G(){var t=e(".page-cart .cart-items");t.html("");let i=v();i.items.length>0?(i.items.forEach(function(s){t.append(`
                    <div class="item" data-item-id="${s.id}">

                        <div class="meta-infos ">

                            <div class="title">${s.quantity}x - ${s.name}</div>
                            <div class="price">${f(s.price*s.quantity)}</div>
                            <a class="add-comments">Adicionar observação</a>

                        </div>

                        <div class="button">

                            <div class="quantity">
                                <button class="rem quantity-remove" data-op="rm">
                                    <i class="mdi mdi-minus"></i>
                                </button>
                                <span class="total quantity-value">${s.quantity}</span>
                                <button class="add quantity-add"  data-op="add">
                                    <i class="mdi mdi-plus"></i>
                                </button>
                            </div>

                        </div>

                    </div>
                `)}),e(".button .add-cart .value").html(f(i.total))):t.html('<div class="item"><h1>Carrinho vazio</h1></div>')}function U(){var t=0;return v().items.forEach(i=>{t+=parseInt(i.quantity)}),t}function w(t){e("#cart .cart-body .items").append(`
                <div class="item" data-item-id="${t.id}">
                    <div class="img">
                        <img src="${t.img}" alt="Imagem do produto" class="image-fluid">
                    </div>
            
                    <div class="meta-infos">
                        <div class="line-1">
                            <div class="title">${t.title}</div>
                            <button type="button" class="remove remove-item-cart"><i class="mdi mdi-delete"></i></button>
                        </div>
                
                        <div class="line-2">
                            <div class="quantity-control">
                                <button type="button" class="quantity-remove" data-op="rm">
                                    <i class="mdi mdi-minus"></i>
                                </button>
                
                                <span class="quantity-value">${t.quantity}</span>
                                        
                                <button type="button" class="quantity-add" data-op="add">
                                    <i class="mdi mdi-plus"></i>
                                </button>
                            </div>
                
                            <div class="prices">
                                <div class="price"><span class="number">${f(t.price)}</span></div>
                            </div>
                        </div>
                    </div> <!-- .meta-infos -->
                </div> <!-- .item -->
            `)}function f(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}function W(t){let i=e("#modal-comments");i.attr("data-id",t);let r=v().items.find(a=>a.id==t);i.find(".observations textarea").val(r.observations),i.toggle()}function R(){let t=e("#modal-comments");t.attr("data-id","0"),t.find(".observations textarea").val(""),t.toggle()}function Z(t){let i=e("#modal-comments");var s=t;let r=v();r.items.map(a=>{if(a.id==s){let o=i.find(".observations textarea").val();a.observations=o}}),x(r),i.attr("data-id","0"),i.find(".observations textarea").val(""),i.toggle()}function H(t,i){const s={};e(".field-error").html("");var r=e('meta[name="root"]').attr("content");for(const a in i){const o=i[a];for(const n of o.split("|")){const[c,p]=n.split(":");switch(c){case"required":t[a]||(s[a]=`O campo ${a} é obrigatório.`);break;case"strong_password":const d=/[A-Z]/,u=/[a-z]/,l=/[0-9]/,b=/[^\w]/,m=8,y=d.test(t[a]),k=u.test(t[a]),D=l.test(t[a]),g=b.test(t[a]),P=t[a].length>=m;y&&k&&D&&g&&P||(s[a]=`A senha no campo ${a} não atende aos critérios de segurança.`);break;case"same":t[a]!==t[p]&&(s[a]=`O campo ${a} deve ser igual ao campo ${p}.`);break;case"string":t[a]&&typeof t[a]!="string"&&(s[a]=`O campo ${a} deve ser uma string.`);break;case"min":t[a]&&t[a].length<p&&(s[a]=`O campo ${a} deve ter no mínimo ${p} caracteres.`);break;case"max":t[a]&&t[a].length>p&&(s[a]=`O campo ${a} deve ter no máximo ${p} caracteres.`);break;case"nullable":if(t[a]!==null&&typeof t[a]<"u")break;continue;case"date":t[a]&&!/^\d{4}-\d{2}-\d{2}$/.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de data válido (YYYY-MM-DD).`);break;case"date_format":const C=p.toUpperCase(),O=/^\d{4}-\d{2}-\d{2}$/;t[a]&&!O.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de data válido (${C}).`);break;case"before_or_equal":const F=new Date;F.setFullYear(F.getFullYear()-18);const N=new Date(t[a]);t[a]&&N>F&&(s[a]=`O campo ${a} deve ser uma data anterior ou igual a ${F.toISOString().split("T")[0]}.`);break;case"email":const $=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;t[a]&&!$.test(t[a])&&(s[a]=`O campo ${a} deve ser um email válido.`);break;case"cpf":const ee=/^\d{3}\.\d{3}\.\d{3}-\d{2}$/;t[a]&&!ee.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de CPF válido (XXX.XXX.XXX-XX).`);break;case"cnpj":const te=/^\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}$/;t[a]&&!te.test(t[a])&&(s[a]=`O campo ${a} deve estar no formato de CNPJ válido (XX.XXX.XXX/XXXX-XX).`);break;case"unique":a==="email"&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/email-unique",data:{email:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1}),a=="cpf"&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/cpf-unique",data:{cpf:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1}),(a=="whatsapp"||a=="phone")&&e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:r+"/phone-unique",data:{phone:t[a]},success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} já está cadastrado.`)},async:!1});break;case"numeric":t[a]&&isNaN(t[a])&&(s[a]=`O campo ${a} deve ser um valor numérico.`);break;case"digits_between":const[M,_]=p.split(",");t[a]&&(t[a].length<M||t[a].length>_)&&(s[a]=`O campo ${a} deve ter entre ${M} e ${_} dígitos.`);break;case"digits":t[a]&&t[a].length!==parseInt(p)&&(s[a]=`O campo ${a} deve ter exatamente ${p} dígitos.`);break;case"exists":let S="";a==="inputCity"&&(S={id:t[a],entity:"city"}),a==="inputState"&&(S={uf:t[a],entity:"state"}),e.ajax({beforeSend:function(){},type:"get",dataType:"json",url:"/rule-exists",data:S,success:function(h){h&&h.success===!1&&(s[a]=`O campo ${a} é inválido.`)},async:!1});break}}}return s}function K(){e(".phoneMask").on("input",function(t){this.value=this.value.replace(/\D/g,"")}),e(".phoneMask").on("blur",function(t){var i=e(this).val().replace(/\D/g,""),s="";i.length===11?s="("+i.substring(0,2)+") "+i.substring(2,3)+" "+i.substring(3,7)+"-"+i.substring(7,11):i.length===10&&(s="("+i.substring(0,2)+") 9 "+i.substring(2,6)+"-"+i.substring(6,10)),e(this).val(s)})}});
